version: '{% if ansible_distribution == "Ubuntu" and ansible_distribution_version == "16.04" %}2{% else %}3{% endif %}'

services:
  collector:
    image: collector_image
    build:
      context: /tmp/collector
      dockerfile: Dockerfile
    container_name: collector
    network_mode: "host"
    restart: always

  scraper:
    image: scraper_image
    build:
      context: /tmp/scraper
      dockerfile: Dockerfile
    container_name: scraper
    network_mode: "host"
    restart: always

  influxdb:
    image: influxdb_image
    build:
      context: /tmp/influxdb
      dockerfile: Dockerfile
    container_name: influxdb
    network_mode: "host"
    restart: always

  grafana:
    image: grafana_image
    build:
      context: /tmp/grafana
      dockerfile: Dockerfile
    container_name: grafana
    network_mode: "host"
    restart: always